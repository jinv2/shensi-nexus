<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¥æ€åº­ | ä¼šå‘˜ä¸­å¿ƒ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background-color: #000; color: #e5e5e5; font-family: monospace; overflow-x: hidden; }
        .nexus-container { width: 100%; max-width: 600px; margin: 0 auto; display: flex; flex-direction: column; align-items: center; }
        .nexus-border { border: 1px solid #333; background: rgba(15,15,15,0.95); backdrop-filter: blur(10px); width: 100%; border-radius: 4px; box-shadow: 0 0 20px rgba(0,0,0,0.8); }
        
        /* ç»ç’ƒå¢™æ•ˆæœ */
        .glass-wall { 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(0,0,0,0.95); 
            backdrop-filter: blur(10px);
            z-index: 1000; 
            display: flex; 
            align-items: center; 
            justify-content: center;
            flex-direction: column;
        }
        
        .auth-card {
            background: rgba(10,10,10,0.9);
            border: 1px solid #444;
            padding: 40px 30px;
            max-width: 400px;
            text-align: center;
            border-radius: 8px;
            box-shadow: 0 0 40px rgba(0, 255, 0, 0.1);
        }
        
        /* é­”æ³•è½® */
        .wheel-wrapper { display: flex; justify-content: center; margin: 30px 0; }
        .magic-wheel-container { position: relative; width: 260px; height: 260px; }
        .magic-wheel { width: 100%; height: 100%; border-radius: 50%; border: 2px solid #222; position: relative; transition: transform 0.6s ease; background: radial-gradient(circle, #111 0%, #000 70%); }
        .wheel-center { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 80px; height: 80px; border-radius: 50%; background: #000; border: 1px solid #333; display: flex; align-items: center; justify-content: center; z-index: 10; font-size: 24px; color: #fff; }
        .wheel-item { position: absolute; top: 50%; left: 50%; width: 50px; height: 50px; margin-left: -25px; margin-top: -25px; display: flex; align-items: center; justify-content: center; cursor: pointer; border-radius: 50%; background: #0a0a0a; border: 1px solid #333; color: #555; }
        
        .pos-0 { transform: rotate(0deg) translate(90px) rotate(0deg); }
        .pos-1 { transform: rotate(72deg) translate(90px) rotate(-72deg); }
        .pos-2 { transform: rotate(144deg) translate(90px) rotate(-144deg); }
        .pos-3 { transform: rotate(216deg) translate(90px) rotate(-216deg); }
        .pos-4 { transform: rotate(288deg) translate(90px) rotate(-288deg); }

        .active-item { color: white; border-color: white; transform: scale(1.2); box-shadow: 0 0 15px currentColor; }
        .app-item { display: flex; justify-content: space-between; align-items: center; padding: 20px; margin-bottom: 10px; border-left: 3px solid transparent; transition: 0.2s; cursor: pointer; }
        .app-item:hover { background: #222; }
        
        /* åŠ è½½åŠ¨ç”» */
        .loader { border: 3px solid #333; border-top: 3px solid #00ff00; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        /* çŠ¶æ€æŒ‡ç¤º */
        .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; }
        .status-online { background-color: #00ff00; box-shadow: 0 0 10px #00ff00; }
        .status-offline { background-color: #ff0000; box-shadow: 0 0 10px #ff0000; }
        
        /* ä¼šå‘˜æ ‡ç­¾ */
        .member-badge { background: linear-gradient(45deg, #00ff00, #009900); color: black; padding: 3px 10px; border-radius: 12px; font-size: 10px; font-weight: bold; display: inline-block; margin-left: 10px; }
    </style>
</head>
<body class="min-h-screen flex flex-col justify-center py-10">

    <!-- ä¼šå‘˜ç»ç’ƒå¢™ -->
    <div id="glass-wall" class="glass-wall">
        <div class="auth-card">
            <h2 class="text-2xl font-bold text-white mb-2">ç¥æ€åº­ - ä¼šå‘˜ä¸­å¿ƒ</h2>
            <p class="text-sm text-gray-400 mb-6">è¯·éªŒè¯æ‚¨çš„èº«ä»½ä»¥è®¿é—®åº”ç”¨çŸ©é˜µ</p>
            
            <!-- ç™»å½•è¡¨å• -->
            <div v-if="authMode === 'login'" class="mb-6">
                <input v-model="loginEmail" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" 
                    class="w-full bg-black border border-gray-700 p-3 mb-4 text-white rounded focus:outline-none focus:border-green-500">
                <input v-model="loginPassword" type="password" placeholder="è¯·è¾“å…¥å¯†ç " 
                    class="w-full bg-black border border-gray-700 p-3 mb-6 text-white rounded focus:outline-none focus:border-green-500">
                <button @click="loginUser" class="w-full bg-green-700 hover:bg-green-600 text-white font-bold py-3 rounded mb-4 transition">
                    ç™»å½•
                </button>
                <button @click="authMode = 'register'" class="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-3 rounded mb-2 transition">
                    æ³¨å†Œæ–°è´¦æˆ·
                </button>
                <button @click="authMode = 'reset'" class="w-full bg-transparent text-gray-500 hover:text-gray-300 text-sm py-2 transition">
                    å¿˜è®°å¯†ç ï¼Ÿ
                </button>
            </div>
            
            <!-- æ³¨å†Œè¡¨å• -->
            <div v-if="authMode === 'register'" class="mb-6">
                <input v-model="registerEmail" type="email" placeholder="è¯·è¾“å…¥é‚®ç®±åœ°å€" 
                    class="w-full bg-black border border-gray-700 p-3 mb-4 text-white rounded focus:outline-none focus:border-green-500">
                <input v-model="registerPassword" type="password" placeholder="è®¾ç½®å¯†ç ï¼ˆè‡³å°‘6ä½ï¼‰" 
                    class="w-full bg-black border border-gray-700 p-3 mb-6 text-white rounded focus:outline-none focus:border-green-500">
                <button @click="registerUser" class="w-full bg-blue-700 hover:bg-blue-600 text-white font-bold py-3 rounded mb-4 transition">
                    æ³¨å†Œ
                </button>
                <button @click="authMode = 'login'" class="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-3 rounded transition">
                    è¿”å›ç™»å½•
                </button>
            </div>
            
            <!-- é‡ç½®å¯†ç  -->
            <div v-if="authMode === 'reset'" class="mb-6">
                <input v-model="resetEmail" type="email" placeholder="è¯·è¾“å…¥æ³¨å†Œé‚®ç®±" 
                    class="w-full bg-black border border-gray-700 p-3 mb-6 text-white rounded focus:outline-none focus:border-green-500">
                <button @click="resetPassword" class="w-full bg-yellow-700 hover:bg-yellow-600 text-white font-bold py-3 rounded mb-4 transition">
                    å‘é€é‡ç½®é‚®ä»¶
                </button>
                <button @click="authMode = 'login'" class="w-full bg-gray-800 hover:bg-gray-700 text-gray-300 font-bold py-3 rounded transition">
                    è¿”å›ç™»å½•
                </button>
            </div>
            
            <!-- åŠ è½½çŠ¶æ€ -->
            <div v-if="loading" class="loader"></div>
            
            <!-- æ¶ˆæ¯æç¤º -->
            <div v-if="message" class="mt-4 p-3 rounded text-sm" :class="messageType === 'success' ? 'bg-green-900/30 text-green-300' : 'bg-red-900/30 text-red-300'">
                {{ message }}
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨ç•Œé¢ -->
    <div id="app" class="nexus-container" style="display: none;">
        <!-- å¤´éƒ¨ -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-white mb-2 tracking-[0.2em]">Shensi-ST</h1>
            <p class="text-[10px] text-gray-500 tracking-[0.5em]">Digital Sovereignty Nexus</p>
            
            <!-- ç”¨æˆ·ä¿¡æ¯ -->
            <div class="mt-4 flex items-center justify-center gap-4">
                <div class="text-sm text-gray-400">
                    <span class="status-indicator status-online"></span>
                    å·²è¿æ¥: <span class="text-green-400 font-bold">{{ userEmail }}</span>
                    <span class="member-badge">ä¼šå‘˜</span>
                </div>
                <button @click="logout" class="text-xs bg-red-900/30 text-red-300 px-3 py-1 rounded hover:bg-red-900/50 transition">
                    é€€å‡ºç™»å½•
                </button>
            </div>
        </div>

        <!-- é­”æ³•è½® -->
        <div class="wheel-wrapper">
            <div class="magic-wheel-container">
                <div class="magic-wheel" :style="{ transform: `rotate(${wheelRotation}deg)` }">
                    <div class="wheel-item pos-0" :class="{'active-item text-green-500': activeTab==='music'}" @click="switchTab('music', 0)"><i class="fas fa-music"></i></div>
                    <div class="wheel-item pos-1" :class="{'active-item text-yellow-500': activeTab==='visual'}" @click="switchTab('visual', 1)"><i class="fas fa-film"></i></div>
                    <div class="wheel-item pos-2" :class="{'active-item text-purple-500': activeTab==='literature'}" @click="switchTab('literature', 2)"><i class="fas fa-book"></i></div>
                    <div class="wheel-item pos-3" :class="{'active-item text-red-500': activeTab==='agent'}" @click="switchTab('agent', 3)"><i class="fas fa-brain"></i></div>
                    <div class="wheel-item pos-4" :class="{'active-item text-gray-300': activeTab==='automation'}" @click="switchTab('automation', 4)"><i class="fas fa-ghost"></i></div>
                </div>
                <div class="wheel-center">ST</div>
            </div>
        </div>

        <!-- åº”ç”¨åˆ—è¡¨ -->
        <div class="w-full">
            <h2 class="text-center text-lg font-bold tracking-widest mb-6" :style="{color: activeColor}">{{ activeTab.toUpperCase() }} MATRIX</h2>
            
            <div v-for="app in currentList" :key="app.slug" @click="openApp(app)" class="nexus-border app-item" :style="{ borderLeftColor: activeColor }">
                <div>
                    <div class="text-xs font-bold text-gray-300 mb-1">{{ app.name }}</div>
                    <div class="text-[10px] text-gray-600">{{ app.description }}</div>
                </div>
                <div class="text-[10px]" :style="{color: activeColor}">è®¿é—® ></div>
            </div>
            
            <div v-if="currentList.length===0" class="text-center text-xs text-gray-700 py-10">[ æ­¤åˆ†ç±»æš‚æ— åº”ç”¨ ]</div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed, onMounted } = Vue;
        
        // Supabase é…ç½®
        const SUPABASE_URL = 'https://enutekcevqcmhrzwdnlt.supabase.co';
        const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImVudXRla2NldnFjbWhyendkbmx0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjY3ODg1MjAsImV4cCI6MjA4MjM2NDUyMH0.WrZ3sRH-0HVXv5NNPTvm00l5kC4qURAaxq0jinxND3E';
        
        createApp({
            setup() {
                // çŠ¶æ€ç®¡ç†
                const glassWall = ref(null);
                const mainApp = ref(null);
                const supabase = ref(null);
                
                // ç”¨æˆ·çŠ¶æ€
                const userEmail = ref('');
                const session = ref(null);
                const loading = ref(false);
                const message = ref('');
                const messageType = ref('');
                
                // è®¤è¯è¡¨å•
                const authMode = ref('login');
                const loginEmail = ref('');
                const loginPassword = ref('');
                const registerEmail = ref('');
                const registerPassword = ref('');
                const resetEmail = ref('');
                
                // åº”ç”¨æ•°æ® - åªåœ¨è¿™é‡Œæ·»åŠ ç¬¬å…­ä¸ªAPPåˆ°MUSIC MATRIX
                const apps = ref([
                    // ==================== MUSIC MATRIX (éŸ³ä¹ç›¸å…³) ====================
                    { slug: 'sonic-weaver', name: 'Sonic Weaver', description: 'AIéŸ³ä¹ç¼–ç»‡ä¸å£°æ³¢ç”Ÿæˆå™¨', category: 'music', url: 'https://shensi-sonic-weaver.vercel.app/' },
                    { slug: 'voice-alchemy', name: 'Voice Alchemy', description: 'AIè¯­éŸ³åˆæˆä¸éŸ³é¢‘å¤„ç†', category: 'music', url: 'https://voice-alchemy-eeiy.vercel.app/' },
                    { slug: 'music-player', name: 'Music Player', description: 'é«˜çº§éŸ³ä¹æ’­æ”¾å™¨ä¸éŸ³æ•ˆå¤„ç†', category: 'music', url: 'https://music-player-v1-one.vercel.app/' },
                    { slug: 'traditional-music', name: 'ä¼ ç»Ÿå¤ä¹', description: 'ä¼ ç»Ÿæ°‘æ—éŸ³ä¹åˆ›ä½œè¾…åŠ©å·¥å…·', category: 'music', url: 'https://shensi-traditional-music-pwa.vercel.app/' },
                    { slug: 'folk-pwa', name: 'æ°‘æ—éŸ³ä¹PWA', description: 'æ°‘æ—éŸ³ä¹è¾…åŠ©åˆ›ä½œPWAåº”ç”¨', category: 'music', url: 'https://shensi-folk-pwa.vercel.app/' },
                    { slug: 'string-pwa', name: 'å…­å¼¦éšå¿ƒ', description: 'å…­å¼¦ä¼ ç»ŸéŸ³ä¹ç»ƒä¹ ä¼´ä¾£PWA', category: 'music', url: 'https://shensi-string-pwa-sixian-suixin-pwa-liard.vercel.app/' }, // ğŸ†• æ–°å¢ç¬¬å…­ä¸ªAPP
                    
                    // ==================== VISUAL MATRIX (è§†è§‰ç›¸å…³) ====================
                    { slug: 'chroma-vision', name: 'Chroma Vision', description: 'AIè§†è§‰è‰²å½©åˆ†æä¸å¤„ç†', category: 'visual', url: 'https://chroma-vision-beta.vercel.app/' },
                    { slug: 'world-genesis', name: 'World Genesis', description: 'AIä¸–ç•Œæ„å»ºä¸åœºæ™¯ç”Ÿæˆ', category: 'visual', url: 'https://world-genesis.vercel.app/' },
                    { slug: 'style-alchemist', name: 'Style Alchemist', description: 'AIé£æ ¼è½¬æ¢ä¸å›¾åƒå¤„ç†', category: 'visual', url: 'https://style-alchemist.vercel.app/' },
                    { slug: 'plot-weaver', name: 'Plot Weaver', description: 'AIå‰§æƒ…ç¼–ç»‡ä¸æ•…äº‹ç”Ÿæˆ', category: 'visual', url: 'https://plot-weaver-five.vercel.app/' },
                    { slug: 'persona-forge', name: 'Persona Forge', description: 'AIè§’è‰²åˆ›å»ºä¸äººç‰©è®¾è®¡', category: 'visual', url: 'https://persona-forge-ten.vercel.app/' },
                    
                    // ==================== LITERATURE MATRIX (æ–‡å­¦ç›¸å…³) ====================
                    { slug: 'shensi-read', name: 'Shensi Read', description: 'AIé˜…è¯»åŠ©æ‰‹ä¸æ–‡æœ¬åˆ†æ', category: 'literature', url: 'https://shensi-read.vercel.app/' },
                    { slug: 'vibe-coder', name: 'Vibe Coder', description: 'AIä»£ç ç”Ÿæˆä¸è¡¥å…¨å·¥å…·', category: 'literature', url: 'https://vibe-coder.vercel.app/' },
                    { slug: 'lingua-sync', name: 'Lingua Sync', description: 'AIå¤šè¯­è¨€åŒæ­¥ä¸ç¿»è¯‘', category: 'literature', url: 'https://lingua-sync-six.vercel.app/' },
                    { slug: 'neural-stream', name: 'Neural Stream', description: 'ç¥ç»ç½‘ç»œæ–‡æœ¬æµç”Ÿæˆ', category: 'literature', url: 'https://neural-stream-woad.vercel.app/' },
                    { slug: 'claritas-terminal', name: 'Claritas Terminal', description: 'AIæ–‡æœ¬æ¸…æ™°åŒ–ç»ˆç«¯', category: 'literature', url: 'https://claritas-terminal.vercel.app/' },
                    
                    // ==================== AGENT MATRIX (æ™ºèƒ½ä»£ç†) ====================
                    { slug: 'agent-zero', name: 'Agent Zero', description: 'åŸºç¡€æ™ºèƒ½ä»£ç†ç³»ç»Ÿ', category: 'agent', url: 'https://agent-zero-five.vercel.app/' },
                    { slug: 'agent-mirror', name: 'Agent Mirror', description: 'é•œåƒåå°„æ™ºèƒ½ä»£ç†', category: 'agent', url: 'https://agent-mirror.vercel.app/' },
                    { slug: 'agent-scholar', name: 'Agent Scholar', description: 'å­¦æœ¯ç ”ç©¶æ™ºèƒ½ä»£ç†', category: 'agent', url: 'https://agent-scholar-xi.vercel.app/' },
                    { slug: 'agent-trend', name: 'Agent Trend', description: 'è¶‹åŠ¿åˆ†ææ™ºèƒ½ä»£ç†', category: 'agent', url: 'https://agent-trend.vercel.app/' },
                    { slug: 'agent-logic', name: 'Agent Logic', description: 'é€»è¾‘æ¨ç†æ™ºèƒ½ä»£ç†', category: 'agent', url: 'https://agent-logic.vercel.app/' },
                    { slug: 'agent-strategos', name: 'Agent Strategos', description: 'ç­–ç•¥åˆ¶å®šæ™ºèƒ½ä»£ç†', category: 'agent', url: 'https://agent-strategos.vercel.app/' },
                    
                    // ==================== AUTOMATION MATRIX (è‡ªåŠ¨åŒ–) ====================
                    { slug: 'ghost-operator', name: 'Ghost Operator', description: 'è‡ªåŠ¨åŒ–å·¥ä½œæµä¸AIåˆ†æçŸ©é˜µ', category: 'automation', url: 'https://ghost-operator.vercel.app/' },
                    { slug: 'monitor-eye', name: 'Monitor Eye', description: 'AIè§†è§‰å·®å¼‚åˆ†æå™¨', category: 'automation', url: 'https://monitor-eye.vercel.app/' },
                    { slug: 'shensi-todo', name: 'Shensi Todo', description: 'ç¥æ€åº­æç®€å¾…åŠäº‹é¡¹PWA', category: 'automation', url: 'https://-shensi-todo-pwa.vercel.app/' },
                    { slug: 'shensi-rhythm', name: 'Shensi Rhythm', description: 'èŠ‚å¥ä¼´å¥ä¸éŸ³ä¹ç”Ÿæˆ', category: 'automation', url: 'https://shensi-rhythm-pwa-.vercel.app/' },
                    { slug: 'shensi-string', name: 'Shensi String', description: 'å››å¼¦éšå¿ƒPWAéŸ³ä¹å·¥å…·', category: 'automation', url: 'https://shensi-string-pwa-sixian-suixin-pwa.vercel.app/' },
                    { slug: 'super-individual', name: 'Super Individual', description: 'è¶…ä¸ªä½“æ„å»ºè€…Â·Web3èº«ä»½åè®®', category: 'automation', url: 'https://super-individual.vercel.app/' }
                ]);
                
                // UIçŠ¶æ€
                const activeTab = ref('music');
                const wheelRotation = ref(0);

                // åˆå§‹åŒ–Supabase
                const initSupabase = () => {
                    supabase.value = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
                    
                    // æ£€æŸ¥ç°æœ‰ä¼šè¯
                    supabase.value.auth.getSession().then(({ data, error }) => {
                        if (error) {
                            console.error('Session check error:', error);
                            showMessage('ä¼šè¯æ£€æŸ¥å¤±è´¥: ' + error.message, 'error');
                            return;
                        }
                        
                        if (data.session) {
                            session.value = data.session;
                            userEmail.value = data.session.user.email;
                            showMainApp();
                        } else {
                            // æ²¡æœ‰ä¼šè¯ï¼Œæ˜¾ç¤ºç™»å½•ç•Œé¢
                            glassWall.value.style.display = 'flex';
                        }
                    });
                    
                    // ç›‘å¬è®¤è¯çŠ¶æ€å˜åŒ–
                    supabase.value.auth.onAuthStateChange((event, currentSession) => {
                        console.log('Auth state changed:', event);
                        if (event === 'SIGNED_IN') {
                            session.value = currentSession;
                            userEmail.value = currentSession.user.email;
                            showMainApp();
                            showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                        } else if (event === 'SIGNED_OUT') {
                            session.value = null;
                            userEmail.value = '';
                            showLogin();
                            showMessage('å·²é€€å‡ºç™»å½•', 'info');
                        } else if (event === 'USER_UPDATED') {
                            showMessage('ç”¨æˆ·ä¿¡æ¯å·²æ›´æ–°', 'success');
                        }
                    });
                };
                
                // æ˜¾ç¤ºä¸»åº”ç”¨ç•Œé¢
                const showMainApp = () => {
                    if (glassWall.value) glassWall.value.style.display = 'none';
                    if (mainApp.value) mainApp.value.style.display = 'flex';
                };
                
                // æ˜¾ç¤ºç™»å½•ç•Œé¢
                const showLogin = () => {
                    if (glassWall.value) glassWall.value.style.display = 'flex';
                    if (mainApp.value) mainApp.value.style.display = 'none';
                    authMode.value = 'login';
                    clearForms();
                };
                
                // æ¸…ç©ºè¡¨å•
                const clearForms = () => {
                    loginEmail.value = '';
                    loginPassword.value = '';
                    registerEmail.value = '';
                    registerPassword.value = '';
                    resetEmail.value = '';
                    message.value = '';
                };
                
                // æ˜¾ç¤ºæ¶ˆæ¯
                const showMessage = (msg, type = 'info') => {
                    message.value = msg;
                    messageType.value = type;
                    
                    // è‡ªåŠ¨éšè—æ¶ˆæ¯
                    setTimeout(() => {
                        message.value = '';
                    }, type === 'success' ? 3000 : 5000);
                };
                
                // ç”¨æˆ·ç™»å½•
                const loginUser = async () => {
                    if (!loginEmail.value || !loginPassword.value) {
                        showMessage('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    
                    try {
                        const { data, error } = await supabase.value.auth.signInWithPassword({
                            email: loginEmail.value,
                            password: loginPassword.value
                        });
                        
                        if (error) throw error;
                        
                        console.log('Login successful:', data);
                        showMessage('ç™»å½•æˆåŠŸï¼', 'success');
                        
                    } catch (error) {
                        console.error('Login error:', error);
                        showMessage('ç™»å½•å¤±è´¥: ' + error.message, 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                // ç”¨æˆ·æ³¨å†Œ
                const registerUser = async () => {
                    if (!registerEmail.value || !registerPassword.value) {
                        showMessage('è¯·è¾“å…¥é‚®ç®±å’Œå¯†ç ', 'error');
                        return;
                    }
                    
                    if (registerPassword.value.length < 6) {
                        showMessage('å¯†ç è‡³å°‘éœ€è¦6ä½å­—ç¬¦', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    
                    try {
                        const { data, error } = await supabase.value.auth.signUp({
                            email: registerEmail.value,
                            password: registerPassword.value,
                            options: {
                                emailRedirectTo: window.location.origin
                            }
                        });
                        
                        if (error) throw error;
                        
                        console.log('Registration successful:', data);
                        showMessage('æ³¨å†ŒæˆåŠŸï¼è¯·æ£€æŸ¥æ‚¨çš„é‚®ç®±ç¡®è®¤é‚®ä»¶ã€‚', 'success');
                        
                        // åˆ‡æ¢å›ç™»å½•ç•Œé¢
                        setTimeout(() => {
                            authMode.value = 'login';
                            loginEmail.value = registerEmail.value;
                            registerEmail.value = '';
                            registerPassword.value = '';
                        }, 3000);
                        
                    } catch (error) {
                        console.error('Registration error:', error);
                        showMessage('æ³¨å†Œå¤±è´¥: ' + error.message, 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                // é‡ç½®å¯†ç 
                const resetPassword = async () => {
                    if (!resetEmail.value) {
                        showMessage('è¯·è¾“å…¥æ³¨å†Œé‚®ç®±', 'error');
                        return;
                    }
                    
                    loading.value = true;
                    
                    try {
                        const { error } = await supabase.value.auth.resetPasswordForEmail(resetEmail.value, {
                            redirectTo: window.location.origin + '/reset-password'
                        });
                        
                        if (error) throw error;
                        
                        showMessage('é‡ç½®å¯†ç é‚®ä»¶å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±ï¼Œè¯·æŸ¥æ”¶ã€‚', 'success');
                        
                        // åˆ‡æ¢å›ç™»å½•ç•Œé¢
                        setTimeout(() => {
                            authMode.value = 'login';
                            resetEmail.value = '';
                        }, 3000);
                        
                    } catch (error) {
                        console.error('Reset password error:', error);
                        showMessage('é‡ç½®å¯†ç å¤±è´¥: ' + error.message, 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                // é€€å‡ºç™»å½•
                const logout = async () => {
                    loading.value = true;
                    
                    try {
                        const { error } = await supabase.value.auth.signOut();
                        if (error) throw error;
                        
                        showMessage('å·²é€€å‡ºç™»å½•', 'info');
                        
                    } catch (error) {
                        console.error('Logout error:', error);
                        showMessage('é€€å‡ºå¤±è´¥: ' + error.message, 'error');
                    } finally {
                        loading.value = false;
                    }
                };
                
                // åˆ‡æ¢æ ‡ç­¾é¡µ
                const switchTab = (tab, index) => {
                    activeTab.value = tab;
                    wheelRotation.value = -90 - (index * 72);
                };
                
                // æ‰“å¼€åº”ç”¨
                const openApp = (app) => {
                    console.log('Opening app:', app.name);
                    
                    if (!session.value) {
                        showMessage('è¯·å…ˆç™»å½•', 'error');
                        return;
                    }
                    
                    try {
                        // ç”Ÿæˆå¸¦æœ‰ç”¨æˆ·tokençš„URL
                        const userToken = session.value.access_token;
                        const appUrl = new URL(app.url);
                        
                        // æ·»åŠ tokenåˆ°URLï¼ˆä»…ç¤ºä¾‹ï¼Œå®é™…åº”ç”¨ä¸­åº”ä½¿ç”¨æ›´å®‰å…¨çš„æ–¹å¼ï¼‰
                        const secureUrl = `${app.url}?token=${encodeURIComponent(userToken)}&email=${encodeURIComponent(userEmail.value)}`;
                        
                        const newWindow = window.open(secureUrl, '_blank');
                        
                        if (!newWindow) {
                            // å¦‚æœå¼¹çª—è¢«é˜»æ­¢ï¼Œæ˜¾ç¤ºæç¤º
                            if (confirm(`æ‰“å¼€ "${app.name}"ï¼Ÿ\n\nï¼ˆæµè§ˆå™¨é˜»æ­¢äº†å¼¹çª—ï¼Œè¯·åœ¨å½“å‰é¡µæ‰“å¼€å—ï¼Ÿï¼‰`)) {
                                window.location.href = secureUrl;
                            }
                        }
                        
                    } catch (error) {
                        console.error('Error opening app:', error);
                        showMessage('æ‰“å¼€åº”ç”¨å¤±è´¥: ' + error.message, 'error');
                    }
                };
                
                // è®¡ç®—å±æ€§
                const currentList = computed(() => apps.value.filter(a => a.category === activeTab.value));
                
                const activeColor = computed(() => ({
                    'music':'#10b981',
                    'visual':'#f59e0b',
                    'literature':'#8b5cf6',
                    'agent':'#ef4444',
                    'automation':'#d1d5db'
                }[activeTab.value]));
                
                // æŒ‚è½½æ—¶åˆå§‹åŒ–
                onMounted(() => {
                    glassWall.value = document.getElementById('glass-wall');
                    mainApp.value = document.getElementById('app');
                    initSupabase();
                });
                
                return { 
                    // ç”¨æˆ·çŠ¶æ€
                    userEmail,
                    loading,
                    message,
                    messageType,
                    authMode,
                    
                    // è¡¨å•æ•°æ®
                    loginEmail,
                    loginPassword,
                    registerEmail,
                    registerPassword,
                    resetEmail,
                    
                    // åº”ç”¨æ•°æ®
                    apps,
                    activeTab,
                    currentList,
                    activeColor,
                    wheelRotation,
                    
                    // æ–¹æ³•
                    loginUser,
                    registerUser,
                    resetPassword,
                    logout,
                    switchTab,
                    openApp
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
